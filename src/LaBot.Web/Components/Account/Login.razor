@page "/Account/Login"
@using Microsoft.AspNetCore.Identity
@using LaBot.Infrastructure.Data
@inject SignInManager<ApplicationUser> SignInManager
@inject NavigationManager NavigationManager

<h3>Login</h3>

<div class="row">
    <div class="col-md-4">
        <EditForm Model="Input" OnValidSubmit="OnValidSubmit">
            <DataAnnotationsValidator />
            <ValidationSummary />

            <div class="form-group">
                <label>Email</label>
                <InputText @bind-Value="Input.Email" class="form-control" />
            </div>

            <div class="form-group">
                <label>Password</label>
                <InputText type="password" @bind-Value="Input.Password" class="form-control" />
            </div>

            <div class="form-group">
                <button type="submit" class="btn btn-primary">Login</button>
            </div>
        </EditForm>

        @if (!string.IsNullOrEmpty(ErrorMessage))
        {
            <div class="alert alert-danger mt-3">@ErrorMessage</div>
        }
    </div>
</div>

@code {
    public class InputModel
    {
        public string Email { get; set; } = "";
        public string Password { get; set; } = "";
    }

    public InputModel Input { get; set; } = new();
    public string? ErrorMessage { get; set; }

    private async Task OnValidSubmit()
    {
        var result = await SignInManager.PasswordSignInAsync(Input.Email, Input.Password, isPersistent: false, lockoutOnFailure: false);
        
        if (result.Succeeded)
        {
            NavigationManager.NavigateTo("/");
        }
        else
        {
            ErrorMessage = "Invalid login attempt.";
        }
    }
}
